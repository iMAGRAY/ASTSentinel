{"agent_hints":{"verbosity":{"enum":["low","medium","high"],"notes":"Agent-only hint; do not forward to API. Encode via system instructions if needed."}},"api":{"endpoint":"/v1/responses","request_contract":{"additionalProperties":false,"properties":{"conversation_id":{"type":["string","null"]},"input":{"$ref":"#/json_schemas/InputItems"},"instructions":{"description":"High-level, one-turn-only instructions","type":["string","null"]},"max_output_tokens":{"minimum":1,"type":["integer","null"]},"metadata":{"additionalProperties":{"type":["string","number","boolean","null"]},"type":"object"},"model":{"pattern":"^gpt-5(-|$)","type":"string"},"previous_response_id":{"type":["string","null"]},"reasoning":{"additionalProperties":false,"properties":{"effort":{"$ref":"#/json_schemas/ReasoningEffort"}},"type":"object"},"store":{"description":"Disable storage with false when required by policy","type":["boolean","null"]},"stream":{"default":false,"type":"boolean"},"text":{"additionalProperties":true,"properties":{"format":{"oneOf":[{"additionalProperties":false,"properties":{"type":{"const":"json_object"}},"required":["type"],"type":"object"},{"additionalProperties":false,"properties":{"name":{"minLength":1,"type":"string"},"schema":{"$ref":"#/json_schemas/OutputSchema"},"type":{"const":"json_schema"}},"required":["type","name","schema"],"type":"object"}]}},"type":"object"},"tools":{"$ref":"#/json_schemas/ToolList"}},"required":["model","input"],"type":"object"},"response_minimal":{"additionalProperties":true,"properties":{"created_at":{"type":"string"},"id":{"type":"string"},"model":{"type":"string"},"output":{"type":"array"},"output_text":{"type":["string","null"]}},"required":["id","model","created_at","output"],"type":"object"}},"api_gateway_policies":{"observability":["log response.id, latency, token usage (input/output/reasoning)","trace tool calls (name, duration, bytes) without full payloads","redact pii in logs"],"request_validation":["model matches ^gpt-5(-|$)","previous_response_id XOR conversation_id","if tools:function — require parameters or input_schema (JSON Schema)","max_output_tokens within per-env caps","store default policy enforced (override to false where required)","reject input where total estimated tokens exceed context window minus safety margin"],"streaming_controls":["SSE budget window per response","abort on no delta for N seconds","cap events/sec to avoid UI overload"],"tool_validation":["tool name in allowlist","arguments strictly pass JSON Schema (no unknown keys)","per-tool rate limits and max concurrent","for mcp connectors — origin allowlist + auth scope checks"]},"audience":["ai_agent","api_gateway","platform_team","security_review","ml_ops","evals"],"ci":{"python":{"deps":["jsonschema"],"validate_script":"import sys, json, jsonschema\nspec = json.load(sys.stdin)\nbase = spec[\"api\"][\"request_contract\"]\njsonschema.validate(instance={\n  \"model\":\"gpt-5\",\n  \"input\":[{\"role\":\"user\",\"content\":[{\"type\":\"input_text\",\"text\":\"hi\"}]}],\n  \"text\":{\"format\":{\"type\":\"json_schema\",\"name\":\"Out\",\"schema\":{\"type\":\"object\",\"additionalProperties\":False}}},\n  \"previous_response_id\": None,\n  \"conversation_id\": None\n}, schema=base)\n# semantic XOR rule\ninst = {\"model\":\"gpt-5\",\"input\":[{\"role\":\"user\",\"content\":[{\"type\":\"input_text\",\"text\":\"hi\"}]}],\"previous_response_id\":\"r1\",\"conversation_id\":\"c1\"}\ntry:\n  jsonschema.validate(instance=inst, schema=base)\n  # enforce semantic check\n  raise SystemExit(2)\nexcept Exception:\n  pass\nprint(\"OK\")"}},"common_issues_and_edges":["Mixing previous_response_id and conversation_id in one request — reject.","Assuming text is at output[0] — inspect output array items and use output_text aggregator.","Not setting max_output_tokens on reasoning tasks leading to overruns.","Overly strict JSON Schema (e.g., too many required fields) causing frequent validation failures.","Letting the model invent tool args — always validate against schema and clamp unknown fields.","Forgetting that instructions do not persist across previous_response_id chains unless re-sent.","Relying on Chat Completions shape (choices[0].message.content) after migration to Responses.","Streaming: writing UI assuming single final blob instead of deltas; handle event loop and backpressure.","MCP server latency/timeouts not tuned; set connect/read timeouts and retry policy."],"document":"GPT‑5 Agent — Machine Context","encoding":{"bom":false,"charset":"UTF-8","newline":"\n","surrogates_forbidden":true},"eval_templates":{"schema":{"additionalProperties":false,"properties":{"goal":{"type":"string"},"inputs":{"items":{"type":"object"},"type":"array"},"metrics":{"items":{"properties":{"fn":{"enum":["exact","jsonpath","cosine","rougeL","judge"]},"key":{"type":"string"},"weight":{"type":"number"}},"required":["key","weight","fn"],"type":"object"},"type":"array"},"name":{"type":"string"},"oracle":{"additionalProperties":true,"type":"object"}},"required":["name","goal","inputs","oracle","metrics"],"type":"object"},"suites":[{"goal":"Ensure parity after migrating Chat Completions → Responses","inputs":[{"expect_schema":{"properties":{"bullets":{"items":{"type":"string"},"type":"array"},"source":{"type":"string"}},"required":["bullets"],"type":"object"},"prompt":"Summarize: {doc}"}],"metrics":[{"fn":"exact","key":"schema_valid","weight":1.0},{"fn":"judge","key":"len>=3","weight":0.3}],"name":"responses_migration_regression","oracle":{"bullets_min":3}},{"goal":"Prevent arg hallucinations; ensure schema-conformant tool args","inputs":[{"prompt":"Get weather in Paris","schema":{"additionalProperties":false,"properties":{"city":{"type":"string"}},"required":["city"],"type":"object"},"tool":"get_weather"}],"metrics":[{"fn":"jsonpath","key":"arg_exact","weight":1.0}],"name":"tool_call_accuracy","oracle":{"city":"Paris"}},{"goal":"Validate SSE UI handles deltas","inputs":[{"prompt":"Write 500-word essay","stream":true}],"metrics":[{"fn":"exact","key":"ttft","weight":1.0}],"name":"streaming_ux","oracle":{"first_token_within_ms":800}},{"goal":"Ensure agent respects max_tool_calls & timeouts","inputs":[{"max_tool_calls":6,"prompt":"Research topic X with sources","timeouts":{"connect_ms":15000,"read_ms":60000}}],"metrics":[{"fn":"exact","key":"tool_calls","weight":1.0}],"name":"mcp_budgeting","oracle":{"max_tool_calls_used":"<=6"}}]},"global_invariants":["Use the Responses API for GPT‑5; do NOT use Chat Completions for agent orchestration.","Pin model snapshots per environment (e.g., gpt-5-YYYY-MM-DD).","Use text.format (json_schema) for Structured Outputs with Responses API; do not use response_format here.","Validate all tool inputs against JSON Schema server‑side before execution.","Never execute model‑provided code/commands directly; route through vetted tools.","Do not request chain-of-thought; prefer concise rationales/step logs if needed.","Set exactly one of previous_response_id or conversation_id in a request.","Assume output is a heterogeneous array; never assume text is at output[0].","Use stream=true for long generations; handle event types like response.output_text.delta."],"implementation_snippets":{"node_minimal":"import OpenAI from \"openai\";\nconst client = new OpenAI();\nconst resp = await client.responses.create({\n  model: \"gpt-5\",\n  input: [{ role: \"user\", content: [{ type: \"input_text\", text: \"3 key risks as JSON\" }]}],\n  text: { format: { type: \"json_schema\", name: \"Output\", schema: { type: \"object\", additionalProperties: false, required: [\"risks\"], properties: { risks: { type: \"array\", items: { type: \"string\" } } } } } },\n  max_output_tokens: 256,\n  store: false\n});\nconsole.log(resp.output_text);","python_minimal":"from openai import OpenAI\nclient = OpenAI()\nresp = client.responses.create(\n  model=\"gpt-5\",\n  input=[{\"role\":\"user\",\"content\":[{\"type\":\"input_text\",\"text\":\"Короткий план в 3 шагах.\"}]}],\n  reasoning={\"effort\":\"minimal\"},\n  text={\"format\":{\"type\":\"json_schema\",\"name\":\"Output\",\"schema\":{\"type\":\"object\",\"additionalProperties\":False,\"required\":[\"steps\"],\"properties\":{\"steps\":{\"type\":\"array\",\"items\":{\"type\":\"string\"}}}}}},\n  max_output_tokens=256,\n  store=False\n)\nprint(resp.output_text)","python_tool_roundtrip":"tools=[{\n  \"type\":\"function\",\n  \"name\":\"get_weather\",\n  \"parameters\":{\"type\":\"object\",\"required\":[\"city\"],\"properties\":{\"city\":{\"type\":\"string\"}}}\n}]\nr1 = client.responses.create(model=\"gpt-5\", tools=tools, input=\"Погода в Казани завтра?\")\n# Execute tool if requested, then send result back:\nr2 = client.responses.create(model=\"gpt-5\", previous_response_id=r1.id, input=[{\"role\":\"tool\",\"content\":[{\"type\":\"output_text\",\"text\":\"{\\\"city\\\":\\\"Kazan\\\",\\\"t\\\":22}\"}]}])","streaming_node":"const stream = await client.responses.stream({\n  model: \"gpt-5\",\n  input: \"Раскрой тему постепенно...\",\n  stream: true\n});\nfor await (const event of stream) {\n  if (event.type === \"response.output_text.delta\") process.stdout.write(event.delta);\n}"},"json_schemas":{"$schema":"https://json-schema.org/draft/2020-12/schema","AssistantContent":{"items":{"anyOf":[{"additionalProperties":true,"properties":{"text":{"type":"string"},"type":{"const":"output_text"}},"required":["type","text"],"type":"object"},{"additionalProperties":true,"properties":{"arguments":{"type":"string"},"name":{"type":"string"},"type":{"const":"tool_call"}},"required":["type","name","arguments"],"type":"object"}]},"minItems":1,"type":"array"},"InputItems":{"items":{"anyOf":[{"additionalProperties":false,"properties":{"content":{"$ref":"#/json_schemas/UserContent"},"role":{"const":"user"}},"required":["role","content"],"type":"object"},{"additionalProperties":false,"properties":{"content":{"$ref":"#/json_schemas/AssistantContent"},"role":{"const":"assistant"}},"required":["role","content"],"type":"object"},{"additionalProperties":false,"properties":{"content":{"$ref":"#/json_schemas/ToolContent"},"role":{"const":"tool"}},"required":["role","content"],"type":"object"},{"additionalProperties":false,"properties":{"content":{"$ref":"#/json_schemas/UserContent"},"role":{"const":"system"}},"required":["role","content"],"type":"object"}]},"maxItems":64,"minItems":1,"type":"array"},"OutputSchema":{"additionalProperties":false,"properties":{},"type":"object"},"ReasoningEffort":{"enum":["minimal","medium","high"],"type":"string"},"TextVerbosity":{"enum":["low","medium","high"],"type":"string"},"ToolContent":{"items":{"anyOf":[{"additionalProperties":true,"properties":{"text":{"type":"string"},"type":{"const":"output_text"}},"required":["type","text"],"type":"object"},{"additionalProperties":true,"properties":{"name":{"type":"string"},"output":{"type":"string"},"type":{"const":"tool_result"}},"required":["type","name","output"],"type":"object"}]},"minItems":1,"type":"array"},"ToolList":{"items":{"oneOf":[{"additionalProperties":false,"properties":{"name":{"type":"string"},"parameters":{"type":"object"},"type":{"const":"function"}},"required":["type","name","parameters"],"type":"object"},{"additionalProperties":false,"properties":{"input_schema":{"type":"object"},"name":{"type":"string"},"type":{"const":"function"}},"required":["type","name","input_schema"],"type":"object"},{"additionalProperties":true,"properties":{"name":{"type":"string"},"type":{"const":"builtin"}},"required":["type","name"],"type":"object"},{"additionalProperties":true,"properties":{"name":{"type":"string"},"type":{"const":"mcp"}},"required":["type","name"],"type":"object"}],"required":["type","name"],"type":"object"},"maxItems":64,"type":"array"},"UserContent":{"items":{"anyOf":[{"additionalProperties":false,"properties":{"text":{"minLength":1,"type":"string"},"type":{"const":"input_text"}},"required":["type","text"],"type":"object"},{"additionalProperties":false,"properties":{"detail":{"default":"auto","enum":["auto","low","high"]},"image_url":{"minLength":1,"type":"string"},"type":{"const":"input_image"}},"required":["type","image_url"],"type":"object"},{"additionalProperties":false,"properties":{"audio":{"minLength":1,"type":"string"},"format":{"enum":["wav","mp3","m4a","webm"]},"type":{"const":"input_audio"}},"required":["type","audio"],"type":"object"}]},"minItems":1,"type":"array"}},"meta":{"generated_at":"2025-08-28T22:44:36.901240Z","hash":"376ce606c7c7d1e30290eb4a56c7e05555dcd9ab19a294761b4596b9e88d0f41"},"models":{"fallbacks":["gpt-5-mini"],"family":"gpt-5","snapshots":{"example":"gpt-5-2025-08-07","policy":"pin_per_env"}},"normative":true,"profiles":{"coder":{"notes":"Return plans via structured outputs if UI needs sections.","request":{"max_output_tokens":2048,"model":"gpt-5","reasoning":{"effort":"medium"}}},"extract_and_validate":{"notes":"Low-latency extraction with strict schema.","request":{"max_output_tokens":256,"model":"gpt-5","reasoning":{"effort":"minimal"},"text":{"format":{"name":"Output","schema":{"additionalProperties":false,"properties":{"items":{"items":{"additionalProperties":false,"type":"object"},"type":"array"}},"required":["items"],"type":"object"},"type":"json_schema"}}}},"research_agent":{"notes":"Enable deep research and streaming for progressive UI.","request":{"max_output_tokens":4096,"model":"gpt-5","reasoning":{"effort":"high"},"stream":true,"tools":[{"name":"web_search","type":"builtin"}]}}},"purpose":"Single source of truth for orchestrating GPT‑5 with the Responses API in production agents. Includes strict I/O contracts, state rules, tool schemas, streaming, security, gateway validation, and eval templates.","references":{"agents_sdk":["https://openai.github.io/openai-agents-python/streaming/"],"notes":"Prefer official OpenAI docs; Azure Learn docs may differ subtly.","openai_docs":["https://platform.openai.com/docs/api-reference/responses","https://platform.openai.com/docs/guides/migrate-to-responses","https://platform.openai.com/docs/guides/conversation-state","https://platform.openai.com/docs/guides/structured-outputs","https://platform.openai.com/docs/guides/tools","https://platform.openai.com/docs/guides/reasoning?api-mode=responses","https://platform.openai.com/docs/guides/streaming-responses","https://platform.openai.com/docs/models/gpt-5","https://platform.openai.com/docs/guides/tools-connectors-mcp","https://platform.openai.com/docs/guides/prompt-engineering/conversation-history","https://platform.openai.com/docs/guides/your-data"]},"security":{"logging":"Log minimal metadata; hash identifiers; never log tool outputs with secrets.","pii_redaction":"Strip secrets from prompts; pass tokens via tools, not in input text.","store":"Set store:false when logs must not persist; otherwise responses may be saved by default per policy."},"state_rules":{"billing_note":"With previous_response_id, earlier inputs in the chain are billed as input tokens.","context_window":"Respect model context window (sum of input + output + reasoning tokens).","exactly_one_state_field":"Set exactly one of previous_response_id or conversation_id; reject if both present.","instructions_scope":"instructions apply to the current request only; prior turns' instructions are not implicitly carried."},"streaming":{"enable":"stream=true","events_examples":["response.created","response.output_text.delta","response.completed"],"notes":["When streaming, output_text may be empty until completion; aggregate deltas.","Do not assume the first output item is text; inspect event types."]},"structured_outputs":{"preferred":"Use text.format.type='json_schema' with a strict schema.","tips":["Set additionalProperties:false everywhere in objects.","Keep schemas small; large or over-constrained schemas increase latency and error rate.","If input is incompatible with schema, define a 'fallback' union shape (e.g., enum 'no_data')."]},"tools_and_connectors":{"builtin_examples":["web_search","file_search","code_interpreter","computer_use"],"mcp":{"budgeting":{"max_tool_calls":12},"timeouts":{"connect_ms":15000,"read_ms":60000},"use":"Prefer OpenAI-maintained connectors for popular services when possible."},"safety_rules":["Tool allowlist by name.","Enforce JSON Schema validation on inputs.","Rate limit tool calls per response and per minute.","Forbid raw shell/SQL/HTTP execution without a dedicated audited tool."]},"version":"2025-08-28+v1.3"}